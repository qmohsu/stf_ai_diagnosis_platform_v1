---
description: STF Project base rules (apply everywhere).
alwaysApply: true
---

# STF Project Base Rules (Phase 1 Pilot)

## Identity and timestamps
- When an output includes an `author` field, set it to: **Li-Ta Hsu**.
- When an output includes a date, use **January 2026** unless a real date is
  explicitly required.

## Project goal (Phase 1)
Build a local-first pilot for AI-assisted vehicle diagnosis:
- Dify workflow + UI (upstream; do NOT fork Dify)
- Local LLM via OpenAI-compatible endpoint (Ollama/vLLM)
- FastAPI backend (`diagnostic_api`)
- Weaviate vector store for SOP/manual retrieval
- Strict JSON output + citations + persistent logging for Phase 1.5 training

## Non-negotiable privacy & data boundaries
- NEVER send raw sensor data to the LLM:
  - no vibration waveforms, no audio frames, no video frames, no full GNSS tracks
- LLM context may contain ONLY summaries, risk scores, and text snippets.
- Redact PII from any user-entered text or maintenance notes before:
  - passing to the LLM
  - writing “training-ready” logs

## Local-first & network rules (runtime)
- Assume runtime has **no public internet access**.
- Do not design solutions that require hosted LLMs or external APIs.
- Prefer deterministic, testable behavior. Fail safe when inputs are missing.

## Output contracts (schema discipline)
- When producing “expert output”, return **JSON only** (no markdown) and adhere
  to the project’s strict schema (v1.0).
- Recommendations must include citations (doc_id#section) or explicitly indicate
  **NO_SOURCE** (and state uncertainty).
- If schema validation fails, repair and retry once; do not loop indefinitely.

## Google coding standards (Python) — applies to ALL Python, including tests
- Follow the Google Python Style Guide:
  - 4 spaces indentation, no tabs
  - line length <= 80 chars
  - `lower_with_under` for functions/vars/modules
  - `CapWords` for classes
  - import grouping: stdlib / third-party / local (alphabetical within groups)
  - clear Google-style docstrings for all public functions/classes
- Type hints are mandatory for function signatures and Pydantic models.
- Prefer explicit, domain-specific exceptions; no silent failures.
- Use structured JSON logging (include context fields; avoid secrets/PII).

## Testing standards (Python) — Google style expectations
- Tests must be readable and deterministic:
  - Arrange / Act / Assert pattern
  - descriptive test names
  - docstring per test explaining intent
  - no external network calls in unit tests
- Tests live under `/tests` mirroring the source structure.
- Validate:
  - schema correctness
  - redaction behavior
  - error handling and safe failures

## Change discipline
- Pin versions in configs (avoid `latest`).
- Never commit secrets. Use `.env.example` and gitignore real `.env`.
- When proposing changes, provide:
  - file paths
  - minimal diffs
  - run/test commands
  - what assumptions were made

