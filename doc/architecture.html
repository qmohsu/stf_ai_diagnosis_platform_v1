<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STF AI Diagnosis Platform - Architecture</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            padding: 20px;
            text-align: center;
        }

        h1 {
            margin-bottom: 20px;
        }

        .mermaid {
            display: flex;
            justify-content: center;
        }
    </style>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</head>

<body>

    <h1>STF AI Diagnosis Platform - Architecture Flowchart</h1>
    <p>System architecture diagram showing data flows between the Technician, API, Infrastructure, and RAG Pipeline.</p>

    <div class="mermaid">
        graph TD
        %% Actors
        User([Technician])

        %% Components
        subgraph "Infrastructure Layer"
        Postgres[(PostgreSQL\nPersistence)]
        Weaviate[(Weaviate\nVector Store)]
        Ollama{{Ollama\nLocal LLM}}
        end

        subgraph "Application Layer"
        API[Diagnostic API\nFastAPI]
        CLI[Ingestion CLI\nPython Script]
        end

        %% Flow 1: Data Ingestion (APP-03)
        subgraph "RAG Ingestion Pipeline"
        direction TB
        Docs[Manuals & Logs] --> CLI
        CLI -- "1. Chunk & Embed" --> Ollama
        Ollama -- "Vectors" --> CLI
        CLI -- "2. Store Objects" --> Weaviate
        end

        %% Flow 2: Diagnostic Workflow (APP-01/02/04)
        User -- "1. POST /diagnose" --> API
        API -- "2. Create Session (PENDING)" --> Postgres

        API -- "3. Search for Context" --> Weaviate
        Weaviate -- "Relevant Docs" --> API

        API -- "4. Generate Diagnosis" --> Ollama
        Ollama -- "Analysis" --> API

        API -- "5. Update Session (COMPLETED)" --> Postgres
        API -- "6. Return Result" --> User

        %% Styling
        classDef storage fill:#e1f5fe,stroke:#01579b,stroke-width:2px;
        classDef compute fill:#f3e5f5,stroke:#4a148c,stroke-width:2px;
        classDef actor fill:#fff3e0,stroke:#e65100,stroke-width:2px;

        class Postgres,Weaviate storage;
        class API,CLI,Ollama compute;
        class User actor;
    </div>

</body>

</html>